# AI 跑团产品 PRD-lite（V1）
日期：2026-01-14
范围：**产品需求与行为规范**（不含技术实现细节）

---

## 1. 产品一句话
一个可持续的 AI 跑团游戏：**以本地权威数据为准**管理战役、角色、地图与规则，减少全文上下文依赖，提升准确性与可复现性。

---

## 2. 用户与场景

### 2.1 目标用户
- 1–4 位玩家，共用同一台 PC（单输入框，轮流操作）。
- 未来可扩展为多台 PC 分别使用不同角色并行接入（本版仅预留）。

### 2.2 典型使用场景
- 碎片时间游玩：随时中断，随时继续任意历史战役（存档选择）。

---

## 3. 核心概念（术语表）

- **战役（Campaign）**：一次可持续跑团的容器。创建战役时选择/生成世界背景、地图与玩家角色集合。
- **回合（Turn）**：一次用户输入到系统输出并落盘的完整交互单位。
- **行动者（Actor）**：当前执行输入的玩家角色（同设备轮流切换）。
- **区域（Area）**：地图上的“完整事件/战斗场景单位”（如房间/大厅）。一次战斗/事件只能在一个区域内发生。
- **终极目标（Ultimate Goal）**：战役创建时生成，不允许改写，可隐藏至玩家发现。
- **里程碑（Milestone）**：节奏控制变量；当 token/上下文压力达到阈值时由系统推进，并要求 AI 加速推进事件。
- **权威状态（Authoritative State）**：系统说了算的数据（例如血量、区域位置、存活状态、地图结构、世界规则、角色卡字段）。

---

## 4. 产品目标与非目标

### 4.1 产品目标
1. **可持续**：战役可中断后继续。
2. **可信**：关键状态以系统为准，不由 AI 记忆。
3. **可扩展**：规则与对话类型通过“对话设置/配置”扩展，不改主流程。
4. **可复现**：同一存档与输入在可控范围内可复现（尤其是状态演进）。

### 4.2 非目标（V1）
- 不做复杂前端展示（但需要最小闭环页面承载：战役选择/新建、输入、输出）。
- 不实现回滚功能（但必须保留设计要求与数据结构预留）。
- 不实现多端并发协作（仅预留扩展位）。

---

## 5. 核心功能（V1）

### 5.1 战役管理
- 新建战役：
  - 输入/选择：世界背景、地图、玩家角色集合
  - 生成：终极目标（可隐藏）、初始里程碑值
- 继续战役：
  - 进入起始页，玩家手动选择上一次战役或任意战役
- 多战役并存：
  - 读取不同存档数据，玩家手动切换（非 AI 控制）

### 5.2 角色管理
- 创建/生成角色（人物生成器）
- 查看/修改角色信息
- 角色可跨战役复用
- 角色字段（最小必备）：
  - 姓名、称号、背景、职业、种族
  - 血量（HP）
  - 技能（现实技能，如开锁/开车等）
  - 能力值（力量/敏捷/智力等，用于成功率判断）

### 5.3 地图与移动
- 地图为必选项
- 玩家拥有明确位置（区域级别）
- 区域移动锁：
  - 不满足条件时禁止切换区域（例如未离开出口范围等）
- 区域内部画面由 AI 描写，但不影响“区域级位置”的权威判断
- 地点允许层级（子地图/子区域）：
  - 子地图可在对话进行中二次生成（地图生成器扩展点）

### 5.4 对话与体验
- 主对话区域：玩家输入文本 → 系统输出 GM 叙事
- 对话类型（玩家手动选择，属于“对话设置”）：
  - 场景描写 / 行动询问 / 规则说明 / 自由聊天
- 信息日志（短期可不展示 UI）：
  - 系统可产生结构化“战斗信息/世界信息”，例如：
    - 「角色A」使用「石头」对「角色B」造成「1」伤害

### 5.5 规则与设置（每战役独立）
可配置项（V1）：
- 文本压缩开关：
  - 不满意压缩准确度时可切换全文上下文（token 增加）
- 血量归零后是否强制结束
- 回滚存档数量 N（仅保留设计，暂不实现）

设置修改时机：
- 会话过程中允许修改；每个战役有独立设置快照。

---

## 6. AI 行为边界（必须遵守）

### 6.1 AI 角色
- AI 扮演严格遵守规则的主持人（GM）
- 如需提供其他角色话语，只能以叙述角度呈现（不“扮演玩家”）

### 6.2 自由聊天边界
- 禁止脱离世界观
- 禁止改规则
- 禁止修改任何权威数据（血量/位置/地图结构/角色背景等）

### 6.3 AI 禁止事项（硬禁止）
- 擅自修改血量
- 改写角色背景（角色卡字段）
- 改写世界规则
- 改写地图地点结构（新增/删除/重命名核心地点，除非通过地图生成器工具请求且被系统批准）

---

## 7. 状态可信与冲突处理

### 7.1 系统权威内容
- 血量（HP）
- 区域级位置（玩家所在区域）
- 角色存活状态
- 世界规则与地图结构
- 角色卡字段（姓名/背景/职业等）

### 7.2 冲突处理策略
当 AI 输出与系统权威状态冲突时：
1. **拦截本次回复**（不展示给玩家）
2. 将“冲突 debug 信息”追加到上一次 Request 重新发送
3. 自动重试最多 **K 次（建议 1–2）**
4. 超过 K：
   - 返回“冲突报告”给玩家（可选项：以系统为准继续 / 手动修正 / 选择回滚点〔未来〕）

---

## 8. 里程碑推进（节奏控制）
- 终极目标不可改写，可隐藏直到玩家发现
- 里程碑由系统维护：
  - 当 token/上下文压力达到阈值时，系统推进里程碑进度值
  - 系统提示词要求 AI 生成“更强的推进事件”，加速向终极目标收束
- 里程碑内容不做硬性限制（由 AI 在规则范围内生成）

---

## 9. 回滚（保留设计要求，V1 不实现）
- 玩家点击历史 AI 回复作为回滚点
- 系统删除回滚点之后的所有内容（对话、摘要、状态一致回退）
- 撤销规则：
  - 第一次回滚后、玩家发送新指令前：允许撤销回滚
  - 一旦回滚后继续对话：不允许撤销（形成新分支）

---

## 10. 扩展路线（方向，不是承诺）
- AI 自动路由对话类型（可能使用额外模型接口）
- 多端接入与多角色并行（基于同一战役的多行动者）
- 更完整状态机（濒死/受限自由/被俘等）与战斗系统
